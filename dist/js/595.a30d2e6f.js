"use strict";(self["webpackChunkvue3_huashuo_system"]=self["webpackChunkvue3_huashuo_system"]||[]).push([[595],{1595:function(e,a,l){l.r(a),l.d(a,{default:function(){return Y}});var t=l(3396),u=l(4870),r=l(2807),d=l(5499),n=l(2568),o=l(3766),p=l(3261),i={getCardById(e){return(0,p.Z)({url:"api/onecard",method:"get",params:{id:e}})},getCard(e){return(0,p.Z)({url:"api/card",method:"get",params:{id:e?.id,type:e?.type,pack:e?.pack,pageSize:e?.pageSize,page:e?.page,keyword:e?.keyword}})},getCardTotal(e){return(0,p.Z)({url:"api/cardtotal",method:"get",params:{id:e?.id,type:e?.type,pack:e?.pack,pageSize:e?.pageSize,page:e?.page}})},getPack(){return(0,p.Z)({url:"api/pack",method:"get"})},getType(){return(0,p.Z)({url:"api/type",method:"get"})},addCard(e){return(0,p.Z)({url:"api/addcard",headers:{"Content-Type":"application/json"},method:"post",data:e})},editCard(e){return(0,p.Z)({url:"api/editcard",headers:{"Content-Type":"application/json"},method:"post",data:e})},delCard(e){return(0,p.Z)({url:"api/card",method:"delete",params:{id:e}})}};const s=(0,o.Q_)("main",{state:()=>({typeOptions:[],packOptions:[],cardTableData:[],searchQuery:{},cardTableDataTotal:309,pageSize:15,page:1}),getters:{},actions:{async getOption(){this.typeOptions=await i.getType(),this.packOptions=await i.getPack()},async addCard(e){await i.addCard(e),this.getCard()},async editCard(e){await i.editCard(e),this.getCard()},async getCardById(e){return await i.getCardById(e)},deleteCard(e){for(let a=0;a<e.length;a++)this.deleteCardById(e[a]??0);setTimeout((()=>{this.getCard()}),0)},async deleteCardById(e){return await i.delCard(e)},async getCard(e){const a=await i.getCard({...e,...this.searchQuery,page:this.page});this.cardTableData=a.rows,this.cardTableDataTotal=a.count},search(e,a,l){this.searchQuery={type:e,pack:a,keyword:l}},pageChange(e){this.page=e}}}),c={class:"dialog-footer"},m=(0,t.Uk)("确认"),g=(0,t.Uk)("取消");var h=(0,t.aZ)({__name:"CardPopup",props:["IsShow","cardId"],emits:["closePopup"],setup(e,{emit:a}){const l=e,r=s(),{typeOptions:d,packOptions:n,page:p}=(0,o.Jk)(r),i=(0,u.iH)(l.IsShow),h=(0,u.iH)(l.cardId);(0,t.YP)((()=>l.IsShow),(e=>{i.value=e}));const v=(0,u.qj)({type:"",pack:"",front:"",back:""});(0,t.YP)((()=>l.cardId),(async e=>{if(0!==e){const a=await r.getCardById(e);console.log("data",a),v.type=a.type,v.pack=a.pack,v.front=a.front,v.back=a.back}else w.value?.resetFields();h.value=e}));const w=(0,u.iH)(),f=(0,u.qj)({type:[{required:!0}],pack:[{required:!0}],front:[{required:!0,min:1,max:30}]}),y=()=>{a("closePopup",!1),i.value=!1},k=()=>{h.value?(console.log("form",v),r.editCard({id:h.value,...v})):r.addCard(v),a("closePopup",!1),p.value=1,w.value?.resetFields(),i.value=!1};return(e,a)=>{const l=(0,t.up)("el-option"),r=(0,t.up)("el-select"),o=(0,t.up)("el-form-item"),p=(0,t.up)("el-input"),s=(0,t.up)("el-form"),h=(0,t.up)("el-button"),b=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(b,{modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value=e),title:"新增卡牌",width:"25%","before-close":y},{footer:(0,t.w5)((()=>[(0,t._)("span",c,[(0,t.Wm)(h,{type:"primary",onClick:k},{default:(0,t.w5)((()=>[m])),_:1}),(0,t.Wm)(h,{onClick:y},{default:(0,t.w5)((()=>[g])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(s,{"label-position":"right","label-width":"25%",rules:f,model:v,ref_key:"ruleFormRef",ref:w},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{label:"卡牌类型",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:v.type,"onUpdate:modelValue":a[0]||(a[0]=e=>v.type=e),placeholder:"请选择卡牌类型"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,u.SU)(d),(e=>((0,t.wg)(),(0,t.j4)(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(o,{label:"从属包",prop:"pack"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:v.pack,"onUpdate:modelValue":a[1]||(a[1]=e=>v.pack=e),placeholder:"请选择卡牌从属包"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,u.SU)(n),(e=>((0,t.wg)(),(0,t.j4)(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(o,{label:"卡牌名",prop:"front"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{modelValue:v.front,"onUpdate:modelValue":a[2]||(a[2]=e=>v.front=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(o,{label:"卡牌描述",prop:"back"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{modelValue:v.back,"onUpdate:modelValue":a[3]||(a[3]=e=>v.back=e),type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])}}});const v=h;var w=v;const f={id:"tableBox"},y=(0,t.Uk)("新增"),k=(0,t.Uk)("删除"),b=(0,t.Uk)("编辑");var C=(0,t.aZ)({__name:"CardTable",setup(e){const a=(0,u.iH)(0),l=s(),{cardTableData:p,cardTableDataTotal:i,page:c,pageSize:m}=(0,o.Jk)(l),g=(0,u.iH)(!1),h=(0,u.iH)(),v=(0,u.iH)([]),C=()=>g.value=!0,_=()=>{g.value=!1,a.value=0},W=e=>{l.pageChange(e),c.value=e,l.getCard({page:c.value,pageSize:m.value})},V=e=>{v.value=e};(0,t.wF)(l.getCard({page:c.value,pageSize:m.value}));const S=function(){a.value=0,C()},U=function(e){a.value=e,C()},T=function(){if(0==v.value.length)return(0,r.z8)({message:(0,t.h)("p",null,[(0,t.h)("span",null,"你没有选中任何卡牌，无法删除。")])}),null;d.T.confirm("你确认要删除这些卡牌吗？","删除卡牌",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e=v.value.map((e=>e.id));l.deleteCard(e),(0,r.z8)({type:"success",message:"成功删除卡牌"})})).catch((()=>{(0,r.z8)({type:"info",message:"删除取消"})}))},I=(0,u.iH)(!0),H=(0,u.iH)(!0);return(0,t.YP)(p,(e=>{I.value=e.filter((e=>{if(null!==e.back&&""!==e.back)return!0})).length>0,H.value=e.filter((e=>{if(null!==e.author&&""!==e.author)return!0})).length>0})),(e,l)=>{const r=(0,t.up)("CardFilte"),d=(0,t.up)("el-button"),o=(0,t.up)("el-col"),s=(0,t.up)("el-header"),v=(0,t.up)("el-table-column"),C=(0,t.up)("el-pagination"),z=(0,t.up)("el-main"),B=(0,t.up)("el-container");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(r),(0,t.Wm)(w,{IsShow:g.value,cardId:a.value,onClosePopup:_},null,8,["IsShow","cardId"]),(0,t._)("div",f,[(0,t.Wm)(B,null,{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(o,{span:4},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{id:"addBtn",onClick:S},{default:(0,t.w5)((()=>[y])),_:1}),(0,t.Wm)(d,{type:"danger",id:"addBtn",onClick:T},{default:(0,t.w5)((()=>[k])),_:1})])),_:1})])),_:1}),(0,t.Wm)(z,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,u.SU)(n.eI),{data:(0,u.SU)(p),stripe:"",style:{width:"100%",height:"120%"},"table-layout":"fixed","max-height":"800",onSelectionChange:V,ref_key:"multipleTableRef",ref:h},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{type:"selection"}),(0,t.Wm)(v,{prop:"id",label:"卡牌编号","min-width":"50",align:"center"}),(0,t.Wm)(v,{prop:"front",label:"卡牌名称","min-width":"200",align:I.value?"left":"center"},null,8,["align"]),I.value?((0,t.wg)(),(0,t.j4)(v,{key:0,prop:"back",label:"卡牌描述",width:"700","show-overflow-tooltip":1,align:"center"})):(0,t.kq)("",!0),(0,t.Wm)(v,{prop:"type",label:"卡牌类型","min-width":"150",align:"center"}),(0,t.Wm)(v,{prop:"pack",label:"从属包","min-width":"150",align:"center"}),H.value?((0,t.wg)(),(0,t.j4)(v,{key:1,prop:"author",label:"作者","min-width":"150",align:"center"})):(0,t.kq)("",!0),(0,t.Wm)(v,{label:"操作",align:"center","min-width":"50"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(d,{size:"small",onClick:a=>U(e.id)},{default:(0,t.w5)((()=>[b])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,t.Wm)(C,{"page-size":(0,u.SU)(m),"pager-count":11,layout:"prev, pager, next","current-page":(0,u.SU)(c),total:(0,u.SU)(i),onCurrentChange:W,"hide-on-single-page":!0,style:{"margin-top":"1%"}},null,8,["page-size","current-page","total"])])),_:1})])),_:1})])])}}}),_=l(89);const W=(0,_.Z)(C,[["__scopeId","data-v-791e4ad2"]]);var V=W;const S=e=>((0,t.dD)("data-v-758e503e"),e=e(),(0,t.Cn)(),e),U={id:"filterBox"},T={class:"selectBox"},I=S((()=>(0,t._)("span",{class:"descript"},"卡牌类型",-1))),H={class:"selectBox"},z=S((()=>(0,t._)("span",{class:"descript"},"从属包",-1))),B={class:"selectBox"},D=S((()=>(0,t._)("span",{class:"descript"},"关键词",-1)));var Z=(0,t.aZ)({__name:"CardFilte",setup(e){const a=(0,u.iH)(),l=(0,u.iH)(),r=(0,u.iH)(),d=s(),{typeOptions:n,packOptions:p}=(0,o.Jk)(d);function i(){d.search(a.value,l.value,r.value),d.getCard()}return(0,t.bv)((()=>{d.getOption(),i()})),(e,d)=>{const o=(0,t.up)("el-option"),s=(0,t.up)("el-select"),c=(0,t.up)("el-input");return(0,t.wg)(),(0,t.iD)("div",U,[(0,t._)("div",T,[I,(0,t.Wm)(s,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=e=>a.value=e),class:"m-2",placeholder:"请选择卡牌类型",size:"large",onChange:i,clearable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,u.SU)(n),(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,t._)("div",H,[z,(0,t.Wm)(s,{modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=e=>l.value=e),class:"m-2",placeholder:"请选择包从属",size:"large",clearable:"",onChange:i},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,u.SU)(p),(e=>((0,t.wg)(),(0,t.j4)(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,t._)("div",B,[D,(0,t.Wm)(c,{modelValue:r.value,"onUpdate:modelValue":d[2]||(d[2]=e=>r.value=e),clearable:"",placeholder:"仅搜索卡牌名称与卡牌描述",onChange:i},null,8,["modelValue"])])])}}});const x=(0,_.Z)(Z,[["__scopeId","data-v-758e503e"]]);var j=x,O=(0,t.aZ)({__name:"CardCURD",setup(e){return(e,a)=>((0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(j),(0,t.Wm)(V)],64))}});const P=O;var Y=P}}]);
//# sourceMappingURL=595.a30d2e6f.js.map